{"componentChunkName":"component---src-templates-post-jsx","path":"/rapidly-extend-a-fastify-app-with-crud-apis-from-loopback","result":{"data":{"markdownRemark":{"html":"<h3 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h3>\n<p><a href=\"https://github.com/No9/fastify-loopback-example\">Go straight to the code</a></p>\n<p>Today I was working on a project that required extending with 5 new REST endpoints. Each complete with a Create, Read, Update and Delete (CRUD) implementation.</p>\n<p>The project was already using a <a href=\"https://expressjs.com/en/guide/using-middleware.html\">standard middleware</a> approach with callback based javascript so I decided to see how <a href=\"https://loopback.io/\">Loopback 4</a> could help in this scenario.</p>\n<p>I was so quick completing the work that I thought I would share what I did with a <a href=\"https://www.fastify.io/\">Fastify</a> example but any middleware compliant node.js web framework should be very similar.</p>\n<p>For those not familiar with <a href=\"https://www.fastify.io/\">Fastify</a> it's a fast, low overhead web framework focusing on high resource utilisation with a strong focus on developer experience.</p>\n<p><a href=\"https://loopback.io/\">Loopback 4</a> is a complete API development system and can host APIs as a standalone project but it is very extensible and easy to integrate with your favourite node.js web framework. Loopback 4 also provides a lot of automation to take the chores out API development as well as providing a solid footing for best practices such as generated API definitions.\n<img src=\"/content/images/2019/07/API-Utility.png\"></p>\n<p>The following is a set of steps to explain how I got there but if you want to jump to the finished service just jump here <a href=\"https://github.com/No9/fastify-loopback-example\">fastify-loopback-example</a></p>\n<p>It's based on the <a href=\"https://loopback.io/doc/en/lb4/express-with-lb4-rest-tutorial.html#add-a-datasource\">original article</a> from the loopback team that focuses on a TypeScript Express example.</p>\n<h3 id=\"prerequisites\" style=\"position:relative;\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prerequisites</h3>\n<p>Assuming you have node.js installed you simply need the loopback client.\nInstall the loopback command line and we are ready to go.\n<code class=\"language-text\">$ npm i -g @loopback/cli</code></p>\n<h3 id=\"fastify-project\" style=\"position:relative;\"><a href=\"#fastify-project\" aria-label=\"fastify project permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fastify Project</h3>\n<p>Let's make a directory and change into it.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ mkdir fastify-loopback-example\n$ cd fastify-loopback-example</code></pre></div>\n<p>We will initialize the project so we can install packages. We can just accept the defaults but feel free to change them if you want.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm init </code></pre></div>\n<p>Once that's complete we can install Fastify.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm install fastify -S</code></pre></div>\n<p>Now let's create a file called index.js - This represents our web app that we are extending.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">const fastify = require(&#39;fastify&#39;)({ logger: true })\n\n// Declare a route\nfastify.get(&#39;/&#39;, (request, reply) =&gt; {\n  reply.send({ hello: &#39;world&#39; })\n})\n\n// Run the server!\nfastify.listen(3000, (err) =&gt; {\n  if (err) {\n    fastify.log.error(err)\n    process.exit(1)\n  }\n  fastify.log.info(`server listening on ${fastify.server.address().port}`)\n})</code></pre></div>\n<p>Now you can check everything is working</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ node index.js\n{&quot;level&quot;:30,&quot;time&quot;:1564344999675,&quot;pid&quot;:15556,&quot;hostname&quot;:&quot;LAPTOP-0AGG9V30&quot;,&quot;msg&quot;:&quot;Server listening at http://127.0.0.1:3000&quot;,&quot;v&quot;:1}\n{&quot;level&quot;:30,&quot;time&quot;:1564344999677,&quot;pid&quot;:15556,&quot;hostname&quot;:&quot;LAPTOP-0AGG9V30&quot;,&quot;msg&quot;:&quot;server listening on 3000&quot;,&quot;v&quot;:1}</code></pre></div>\n<h3 id=\"extending-with-loopback\" style=\"position:relative;\"><a href=\"#extending-with-loopback\" aria-label=\"extending with loopback permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Extending with Loopback</h3>\n<p>Still in the project folder create a new loopback service.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ lb4 app services\n? Project description: An application for recording notes.\n? Project root directory: (services)\n? Application class name: (ServicesApplication)\n ◉ Enable eslint: add a linter with pre-configured lint rules\n ◉ Enable prettier: install prettier to format code conforming to rules\n ◉ Enable mocha: install mocha to run tests\n ◉ Enable loopbackBuild: use @loopback/build helpers (e.g. lb-eslint)\n ◉ Enable vscode: add VSCode config files\n❯◯ Enable docker: include Dockerfile and .dockerignore\n ◉ Enable repositories: include repository imports and RepositoryMixin\n ◉ Enable services: include service-proxy imports and ServiceMixin\n # npm will install dependencies now\n Application service was created in service.</code></pre></div>\n<p>Now change into the services folder</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ cd services</code></pre></div>\n<h3 id=\"create-a-model\" style=\"position:relative;\"><a href=\"#create-a-model\" aria-label=\"create a model permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a Model</h3>\n<p>Now we are going to create a model that will automatically generate our CRUD endpoints by running <code class=\"language-text\">lb4 model</code> and creating <code class=\"language-text\">id</code>, <code class=\"language-text\">title</code> and <code class=\"language-text\">content</code> properties.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ lb4 model\n? Model class name: Note\n? Please select the model base class Entity (A persisted model with an ID)\n? Allow additional (free-form) properties? No\nModel Note will be created in src/models/note.model.ts\n\nLet&#39;s add a property to Note\nEnter an empty property name when done\n\n? Enter the property name: id\n? Property type: number\n? Is id the ID property? Yes\n? Is it required?: Yes\n? Default value [leave blank for none]:\n\nLet&#39;s add another property to Note\nEnter an empty property name when done\n\n? Enter the property name: title\n? Property type: string\n? Is it required?: Yes\n? Default value [leave blank for none]:\n\nLet&#39;s add another property to Note\nEnter an empty property name when done\n\n? Enter the property name: content\n? Property type: string\n? Is it required?: No\n? Default value [leave blank for none]:\n\nLet&#39;s add another property to Note\nEnter an empty property name when done</code></pre></div>\n<h3 id=\"create-a-datastore\" style=\"position:relative;\"><a href=\"#create-a-datastore\" aria-label=\"create a datastore permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create A Datastore</h3>\n<p>This example uses a flat file as a database but storage is abstracted in loopback and support for most of the common databases is supported.\nSee the <a href=\"https://loopback.io/doc/en/lb2/Database-connectors.html\">list of connectors</a> for more details.\nStill in the services folder create a data directory\nand run the <code class=\"language-text\">lb4 datasource ds</code> command.</p>\n<p>Select In-memory db and skip the browser config by pressing return and enter <code class=\"language-text\">./services/data/data.json</code> for the server config.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ mkdir data\n$ touch data/ds.json\n$ lb4 datasource ds\n? Select the connector for ds:\n&gt; In-memory db (supported by StrongLoop)\n  In-memory key-value connector (supported by StrongLoop)\n  IBM Object Storage (supported by StrongLoop)\n  IBM DB2 (supported by StrongLoop)\n  IBM DashDB (supported by StrongLoop)\n  IBM MQ Light (supported by StrongLoop)\n  IBM Cloudant DB (supported by StrongLoop)\n(Move up and down to reveal more choices)</code></pre></div>\n<p>Now add the following sample data to the file.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n  &quot;ids&quot;: {\n    &quot;Note&quot;: 3\n  },\n  &quot;models&quot;: {\n    &quot;Note&quot;: {\n      &quot;1&quot;: &quot;{\\&quot;title\\&quot;:\\&quot;Things I need to buy\\&quot;,\\&quot;content\\&quot;:\\&quot;milk, cereal, and waffles\\&quot;,\\&quot;id\\&quot;:1}&quot;,\n      &quot;2&quot;: &quot;{\\&quot;title\\&quot;:\\&quot;Great frameworks\\&quot;,\\&quot;content\\&quot;:\\&quot;LoopBack is a great framework\\&quot;,\\&quot;id\\&quot;:2}&quot;\n    }\n  }\n}</code></pre></div>\n<h3 id=\"create-a-repository\" style=\"position:relative;\"><a href=\"#create-a-repository\" aria-label=\"create a repository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a Repository</h3>\n<p>A Repository represents a specialized Service interface that provides strong-typed data access (for example, CRUD) operations of a domain model against the underlying database or service.\nTo create the repository, run the <code class=\"language-text\">lb4 repository</code> command and choose the <code class=\"language-text\">DsDataSource</code>, as the datasource, <code class=\"language-text\">Note</code> model as the model, and <code class=\"language-text\">DefaultCrudRepository</code> as the repository base class.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ lb4 repository\n? Please select the datasource DsDatasource\n? Select the model(s) you want to generate a repository Note\n? Please select the repository base class DefaultCrudRepository (Legacy juggler bridge)\n   create src\\repositories\\note.repository.ts\n   update src\\repositories\\index.ts\n\nRepository NoteRepository was created in src\\repositories/</code></pre></div>\n<h3 id=\"create-a-note-controller\" style=\"position:relative;\"><a href=\"#create-a-note-controller\" aria-label=\"create a note controller permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a Note Controller</h3>\n<p>A Controller is a class that implements operations defined by an application’s API. It implements an application’s business logic and acts as a bridge between the HTTP/REST API and domain/database models.</p>\n<p>We create one for this project using the <code class=\"language-text\">lb4 controller note</code> command, with the <code class=\"language-text\">REST Controller with CRUD functions</code> type, <code class=\"language-text\">Note model</code>, and <code class=\"language-text\">NoteRepository repository</code>. The id’s type will be number and base HTTP path name is the default /notes</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ lb4 controller note\nController Note will be created in src/controllers/note.controller.ts\n\n? What kind of controller would you like to generate? REST Controller with CRUD functions\n? What is the name of the model to use with this CRUD repository? Note\n? What is the name of your CRUD repository? NoteRepository\n? What is the name of ID property? id\n? What is the type of your ID? number\n? What is the base HTTP path name of the CRUD operations? /notes\n   create src\\controllers\\note.controller.ts\n   update src\\controllers\\index.ts\n\nController Note was created in src\\controllers/</code></pre></div>\n<h3 id=\"build-the-project\" style=\"position:relative;\"><a href=\"#build-the-project\" aria-label=\"build the project permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Build the project</h3>\n<p>Now we can build our project with our models</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm run clean\n$ npm run build</code></pre></div>\n<p>This will create a <code class=\"language-text\">dist</code> folder that we will reference from our main application.</p>\n<h3 id=\"update-the-application\" style=\"position:relative;\"><a href=\"#update-the-application\" aria-label=\"update the application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Update the Application</h3>\n<p>Now we can add it to the fastify application.\nFirst require it into <code class=\"language-text\">index.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">const ServicesApplication = require(&#39;./services/dist/application&#39;).ServicesApplication</code></pre></div>\n<p>Then we create a new instance of the application with an empty config.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var lbApp = new ServicesApplication({});</code></pre></div>\n<p>As we are running the service from a folder that is above the service folder we need to tell the app where the models are.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">lbApp.projectRoot = __dirname + &#39;/services/dist&#39;</code></pre></div>\n<p>Next we need to boot the app before we start the server and attach the route so we wrap our current code with a promise.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">lbApp.boot().then(function() {\n    // Declare a route\n    fastify.use(&#39;/api&#39;, lbApp.requestHandler)\n\n    fastify.get(&#39;/&#39;, (request, reply) =&gt; {\n    reply.send({ hello: &#39;world&#39; })\n    })\n\n    // Run the server!\n    fastify.listen(3000, (err) =&gt; {\n    if (err) {\n        fastify.log.error(err)\n        process.exit(1)\n    }\n    fastify.log.info(`server listening on ${fastify.server.address().port}`)\n    })\n})</code></pre></div>\n<h3 id=\"a-final-tweak\" style=\"position:relative;\"><a href=\"#a-final-tweak\" aria-label=\"a final tweak permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A Final Tweak</h3>\n<p>Unfortunately there is a dependency between the API explorer and the underlying web framework where the explorer expects the request object to have a <code class=\"language-text\">baseUrl</code> property.\nThere is <a href=\"https://github.com/strongloop/loopback-next/pull/3133\">work on going to resolve this</a> but for now we have to augment the request to explorer with this property so we add a middleware component to deal with this.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">    fastify.use(&#39;/api/explorer&#39;, function(req, res, next) {\n        req.baseUrl = &#39;/api&#39;\n        next();\n    })</code></pre></div>\n<p>So the completed <code class=\"language-text\">index.js</code> for the project looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">const fastify = require(&#39;fastify&#39;)({ logger: true })\n\nconst ServicesApplication = require(&#39;./services/dist/application&#39;).ServicesApplication\nvar lbApp = new ServicesApplication({});\nlbApp.projectRoot = __dirname + &#39;/services/dist&#39;\n\nlbApp.boot().then(function() {\n    fastify.use(&#39;/api/explorer&#39;, function(req, res, next) {\n        req.baseUrl = &#39;/api&#39;\n        next();\n    })\n    // Attach the APIs and explorer\n    fastify.use(&#39;/api&#39;, lbApp.requestHandler)\n    // Declare a route\n    fastify.get(&#39;/&#39;, (request, reply) =&gt; {\n        reply.send({ hello: &#39;world&#39; })\n    })\n\n    // Run the server!\n    fastify.listen(3000, (err) =&gt; {\n    if (err) {\n        fastify.log.error(err)\n        process.exit(1)\n    }\n    fastify.log.info(`server listening on ${fastify.server.address().port}`)\n    })\n})</code></pre></div>\n<p>Now we can start our index service again </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ node index.js</code></pre></div>\n<p>The explorer will be available at\n<a href=\"http://localhost:3000/api/explorer/\">http://localhost:3000/api/explorer/</a>\nAnd the Notes should be available at the endpoint\n<a href=\"http://localhost:3000/api/notes\">http://localhost:3000/api/notes</a>\n<img src=\"/content/images/2019/07/note-json.png\" alt=\"Final Output\"></p>\n<p>If you have made it this far thanks a lot for following and please ask any questions to <a href=\"https://twitter.com/dhigit9\">@dhigit9 on twitter</a>.\nAlso a big thanks to <a href=\"https://twitter.com/bajtos\">Miroslav</a> for helping with the \"Tweak\"</p>","timeToRead":8,"excerpt":"Introduction Go straight to the code Today I was working on a project that required extending with 5 new REST endpoints. Each complete with…","frontmatter":{"title":"Rapidly extend a Fastify app with automated API generation from LoopBack","cover":"./images/cover.png","date":"2019-07-28","category":"tech","tags":["programming","nodejs","fastify","loopback"],"author":"anton"},"fields":{"slug":"/rapidly-extend-a-fastify-app-with-crud-apis-from-loopback"}},"prev":{"excerpt":"Update\nIf you are using OI hipster most of these steps won't apply but some of the unmangling and compile…","frontmatter":{"title":"node.js on Open Indiana","cover":"https://unsplash.it/1280/500/?random?BoldMage","date":"2016-12-29"},"fields":{"slug":"/node-js-on-open-indiana"}},"next":{"excerpt":"The following is a set of notes for installing VSCode on FreeBSD and getting a debugger up and running in a step…","frontmatter":{"title":"Debugging Rust with VSCode on FreeBSD","cover":"images/debug-rust.png","date":"2018-12-28"},"fields":{"slug":"/debugging-rust-with-vscode-on-freebsd"}},"authors":{"edges":[{"node":{"uid":"anton","name":"Anton Whalley","image":"https://avatars2.githubusercontent.com/u/130940?s=460&v=4","url":"http://gatsbyjs.org/","bio":""}}]}},"pageContext":{"slug":"/rapidly-extend-a-fastify-app-with-crud-apis-from-loopback","total":11,"prev":"/node-js-on-open-indiana","next":"/debugging-rust-with-vscode-on-freebsd"}}}