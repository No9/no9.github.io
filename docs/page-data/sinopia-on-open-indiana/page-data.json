{"componentChunkName":"component---src-templates-post-jsx","path":"/sinopia-on-open-indiana","result":{"data":{"markdownRemark":{"html":"<p>This article is just a quick set of notes that I took while setting up <a href=\"https://github.com/rlidwka/sinopia\">Sinopia</a> on <a href=\"http://www.openindiana.org/\">OpenIndiana</a>. It should be useful if you are looking to set up any <a href=\"https://nodejs.org\">node.js</a> processes on <a href=\"http://wiki.illumos.org/display/illumos/illumos+Home\">illumOS</a> based operating systems.  </p>\n<p><a href=\"https://github.com/rlidwka/sinopia\">Sinopia</a> is an open source private/caching npm repository server. It's super simple to setup and very handy as it works as an offline repository.</p>\n<p><strong>Install</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm install sinopia -g</code></pre></div>\n<p>Now to ensure that it runs as a service on openindiana you need to do the following steps: </p>\n<p>Create a sinopia-manifest.xml as defined below and change the <code class=\"language-text\">envvar PATH</code>, <code class=\"language-text\">envvar HOME</code> and <code class=\"language-text\">exec_method exec</code> locations to match your machine.\n<sub>N.B. I am calling node directly rather than running sinopia command to illustrate how to configure a node application in general</sub></p>\n<p>You can find the values for those attributes through the usual commands</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ echo $PATH\n/usr/local/bin:/usr/gnu/bin:/usr/bin:/usr/sbin:/sbin/opt/local/sbin:/opt/local/bin:/home/anton/tools/bin\n$ echo $HOME\n/home/anton\n$ which node\n/usr/local/bin/node\n$ npm root -g\n/home/anton/tools/lib/node_modules</code></pre></div>\n<p><strong>Check Service Depdendancies</strong></p>\n<p>There are dependencies on network and filesystem services being available. These are defined in <code class=\"language-text\">dependency</code> tags.\nThe <code class=\"language-text\">service_fmri</code> can vary in illumOS distros so double check the names by listing the services.\n<code class=\"language-text\">$ svcs</code> will list all services along with there qualified names</p>\n<p>i.e. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">...\nonline          7:38:01 svc:/network/service:default\nonline          7:38:10 svc:/network/routing-setup:default\n....</code></pre></div>\n<p><strong>sinopia-manifest.xml</strong></p>\n<p><a href=\"https://gist.githubusercontent.com/No9/472cc7f5bb9cc581735c40d0f4a0ed0c/raw/bcc790f1ecf872b4858ffe574c8be3731d188d02/sinopia-manifest.xml\">Download it here</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;?xml version=&quot;1.0&quot;?&gt;\n&lt;!DOCTYPE service_bundle SYSTEM &quot;/usr/share/lib/xml/dtd/service_bundle.dtd.1&quot;&gt;\n&lt;service_bundle type=&quot;manifest&quot; name=&quot;sinopia&quot;&gt;\n  &lt;service name=&quot;site/sinopia&quot; type=&quot;service&quot; version=&quot;1&quot;&gt;\n\n    &lt;create_default_instance enabled=&quot;true&quot;/&gt;\n\n    &lt;single_instance/&gt;\n\n    &lt;dependency name=&quot;network&quot; grouping=&quot;require_all&quot; restart_on=&quot;refresh&quot; type=&quot;service&quot;&gt;\n      &lt;service_fmri value=&quot;svc:/network/service:default&quot;/&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency name=&quot;filesystem&quot; grouping=&quot;require_all&quot; restart_on=&quot;refresh&quot; type=&quot;service&quot;&gt;\n      &lt;service_fmri value=&quot;svc:/system/filesystem/local&quot;/&gt;\n    &lt;/dependency&gt;\n\n    &lt;method_context working_directory=&quot;/home/anton/tools/bin&quot;&gt;\n      &lt;method_credential user=&quot;anton&quot; group=&quot;staff&quot; privileges=&#39;basic,net_privaddr&#39;  /&gt;\n      &lt;method_environment&gt;\n        &lt;envvar name=&quot;PATH&quot; value=&quot;/usr/local/bin:/usr/gnu/bin:/usr/bin:/usr/sbin:/sbin/opt/local/sbin:/opt/local/bin:/home/anton/tools/bin&quot;/&gt;\n        &lt;envvar name=&quot;HOME&quot; value=&quot;/home/anton&quot;/&gt;\n      &lt;/method_environment&gt;\n    &lt;/method_context&gt;\n\n    &lt;exec_method\n      type=&quot;method&quot;\n      name=&quot;start&quot;\n      exec=&quot;/usr/local/bin/node /home/anton/tools/lib/node_modules/sinopia/lib/cli.js &quot;\n      timeout_seconds=&quot;60&quot;/&gt;\n\n    &lt;exec_method\n      type=&quot;method&quot;\n      name=&quot;stop&quot;\n      exec=&quot;:kill&quot;\n      timeout_seconds=&quot;60&quot;/&gt;\n\n    &lt;property_group name=&quot;startd&quot; type=&quot;framework&quot;&gt;\n      &lt;propval name=&quot;duration&quot; type=&quot;astring&quot; value=&quot;child&quot;/&gt;\n      &lt;propval name=&quot;ignore_error&quot; type=&quot;astring&quot; value=&quot;core,signal&quot;/&gt;\n    &lt;/property_group&gt;\n\n    &lt;property_group name=&quot;application&quot; type=&quot;application&quot;&gt;\n\n    &lt;/property_group&gt;\n\n\n    &lt;stability value=&quot;Evolving&quot;/&gt;\n\n    &lt;template&gt;\n      &lt;common_name&gt;\n        &lt;loctext xml:lang=&quot;C&quot;&gt;node.js sinopia service&lt;/loctext&gt;\n      &lt;/common_name&gt;\n    &lt;/template&gt;\n\n  &lt;/service&gt;\n\n&lt;/service_bundle&gt;</code></pre></div>\n<p><strong>Verify your changes</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ svccfg validate sinopia-manifest.xml </code></pre></div>\n<p>Now as root:\n<strong>Import the service</strong> </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># svccfg import sinopia-manifest.xml</code></pre></div>\n<p><strong>Start the service</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># svcadm enable site/sinopia</code></pre></div>\n<p>Sinopia should now be running and available on <a href=\"http://localhost:4873/\">http://localhost:4873/</a></p>\n<p>You should now set npm to use it as a cache and your done.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm set registry http://localhost:4873/</code></pre></div>\n<p><strong>If things go wrong</strong></p>\n<p>If the import went ok but the site isn't there check the service logs.\nYou can find out info on a service with svcs</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># svcs -x site/sinopia\nsvc:/site/sinopia:default (node.js sinopia service)\n State: online since  2 July 2016 09:33:46 IST\n   See: /var/svc/log/site-sinopia:default.log\nImpact: None.</code></pre></div>\n<p>This will tell you where the logs are and you can use that to trouble shoot issues.</p>\n<p>Hope you found this useful and <a href=\"https://twitter.com/dhigit9\">hit me up on twitter</a> if you want more info.  </p>","timeToRead":3,"excerpt":"This article is just a quick set of notes that I took while setting up Sinopia on OpenIndiana. It should be useful if you are looking to set…","frontmatter":{"title":"Sinopia on Open Indiana","cover":"https://unsplash.it/1280/500/?random?BoldMage","date":"2016-12-29","category":"tech","tags":["programming","nodejs"],"author":"anton"},"fields":{"slug":"/sinopia-on-open-indiana"}},"prev":{"excerpt":"With the latest release of chromiumify you can now publish and install Chrome Apps from NPM. {<1>}node In this…","frontmatter":{"title":"chromiumify #2","cover":"https://unsplash.it/1280/500/?random?BoldMage","date":"2016-12-29"},"fields":{"slug":"/chromiumify-2"}},"next":{"excerpt":"Introduction Recently BSD UNIXes are being acknowledged by the application development community as an…","frontmatter":{"title":"DTrace flamegraphs for FreeBSD and node.js","cover":"images/dtrace-freebsd-cover.png","date":"2016-12-29"},"fields":{"slug":"/dtrace-flamegraphs-for-freebsd-and-node-js"}},"authors":{"edges":[{"node":{"uid":"anton","name":"Anton Whalley","image":"https://avatars2.githubusercontent.com/u/130940?s=460&v=4","url":"http://gatsbyjs.org/","bio":""}}]}},"pageContext":{"slug":"/sinopia-on-open-indiana","total":11,"prev":"/chromiumify-2","next":"/dtrace-flamegraphs-for-freebsd-and-node-js"}}}